{% extends "base.html" %}

{% block title %}Robot Control - SecuBot{% endblock %}

{% block head %}
<style>
    /* Fullscreen layout - no scrolling */
    body {
        overflow: hidden;
    }

    /* ===== Settings Slide-In Panel ===== */
    .settings-panel {
        position: fixed;
        inset: 0;
        z-index: 1000;
        display: flex;
        align-items: flex-end;
        justify-content: stretch;
        /* Hidden by default using visibility + pointer-events (NOT display:none)
           This allows CSS transitions to work properly */
        visibility: hidden;
        pointer-events: none;
        transition: visibility 0s 0.3s; /* delay hiding until animation finishes */
    }
    .settings-panel.open {
        visibility: visible;
        pointer-events: auto;
        transition: visibility 0s 0s; /* instantly visible when opening */
    }

    .settings-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(4px);
        opacity: 0;
        transition: opacity 0.3s ease-out;
    }
    .settings-panel.open .settings-backdrop {
        opacity: 1;
    }

    .settings-panel-content {
        position: relative;
        width: 100%;
        max-height: 70vh;
        background: linear-gradient(135deg, rgba(30, 30, 30, 0.97), rgba(20, 20, 20, 0.97));
        border-radius: 16px 16px 0 0;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
        overflow-y: auto;
        transform: translateY(100%);
        transition: transform 0.3s ease-out;
    }
    .settings-panel.open .settings-panel-content {
        transform: translateY(0);
    }

    .settings-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        background: rgba(30, 30, 30, 0.97);
        backdrop-filter: blur(8px);
        z-index: 10;
    }

    .settings-close-btn {
        padding: 0.5rem;
        border-radius: 0.5rem;
        color: white;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }
    .settings-close-btn:hover {
        background: rgba(255, 68, 68, 0.3);
        transform: scale(1.1);
    }

    .settings-panel-body {
        padding: 1.5rem;
    }

    /* Settings button active state */
    #quick-settings-btn.settings-active {
        color: #00E8DA;
        background: rgba(0, 232, 218, 0.15);
        border-radius: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Fullscreen Video Container -->
<div class="relative w-screen h-screen bg-black">
    <!-- Video Feed -->
    <img id="video-feed"
         src="{{ url_for('views.video_feed') }}"
         class="fullscreen-video"
         alt="Robot Video Feed">

    <!-- Bottom-Left HUD Group -->
    <div class="hud-bottom-left">
        <!-- Speed Slider (Left Side) -->
        <div class="hud-speed-slider">
            <input type="range"
                   id="speed-slider"
                   min="0"
                   max="100"
                   step="5"
                   value="100"
                   class="slider-horizontal">
            <span class="speed-percentage" id="speed-percentage">100%</span>
            <!-- RAGE MODE Toggle Icon (Running Human) -->
            <svg id="rage-mode-btn" class="speed-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="color: #00E8DA; cursor: pointer; transition: all 0.2s; filter: drop-shadow(0 0 2px black);" title="RAGE MODE: Bypass all smoothing for raw control (DANGEROUS!)">
                <path id="rage-mode-icon" d="M13,2 C14.6569,2 16,3.34315 16,5 C16,6.4374176 14.989097,7.6387305 13.6394248,7.93171628 L13.469,7.96356 L14.9049,10.261 L16.6286,9.57152 C17.1414,9.36641 17.7234,9.61583 17.9285,10.1286 C18.11895,10.6047714 17.9175097,11.1406102 17.4771844,11.3789437 L17.3714,11.4285 L15.6477,12.118 C14.8018647,12.4562588 13.842291,12.1788775 13.3046353,11.4607677 L13.2089,11.321 L13.0463,11.0609 L12.4403,13.4851 C12.38606,13.7019 12.298348,13.901548 12.184076,14.0798456 L12.0935,14.2095 L13.7468,15.4376 C14.1430667,15.732 14.4146519,16.161037 14.5132351,16.640361 L14.542,16.8223 L14.895,20 L15,20 C15.5523,20 16,20.4477 16,21 C16,21.51285 15.613973,21.9355092 15.1166239,21.9932725 L15,22 L14.0895,22 C13.5690357,22 13.1258286,21.63665 13.0156081,21.1386974 L12.9962,21.0215 L12.5542,17.0431 L9.40368,14.7028 C9.34671,14.6605 9.29553,14.6132 9.2503,14.5621 C8.69851333,14.1200733 8.40463653,13.4019044 8.52705735,12.6715052 L8.55972,12.5149 L9.35399,9.33783 L7.78454,9.80867 L6.94868,12.3162 C6.77404,12.8402 6.20772,13.1233 5.68377,12.9487 C5.19725429,12.7864786 4.9183499,12.286602 5.0208232,11.7965551 L5.05132,11.6838 L5.88717,9.17621 C6.07583833,8.61019583 6.50617896,8.16078701 7.05678434,7.94576318 L7.20984,7.89302 L10.6474,6.86174 C10.2421,6.3502 10,5.70337 10,5 C10,3.34315 11.3431,2 13,2 Z M8.2,15.4 C8.53137,14.9582 9.15817,14.8686 9.6,15.2 C10.0078154,15.5059077 10.1155314,16.0635172 9.86903487,16.4949808 L9.8,16.6 L8.5838,18.2216 C8.13599375,18.8186938 7.32402148,18.990309 6.67848165,18.6455613 L6.55175,18.5697 L4.62197,17.2832 C4.22939,17.5957 3.65616,17.5704 3.29289,17.2071 C2.93241,16.8466385 2.90468077,16.2793793 3.20970231,15.8871027 L3.29289,15.7929 L3.7871,15.2987 C4.09658182,14.9892455 4.56555124,14.9173942 4.94922239,15.107564 L5.06152,15.1725 L7.26759,16.6432 L8.2,15.4 Z M13,4 C12.4477,4 12,4.44772 12,5 C12,5.55228 12.4477,6 13,6 C13.5523,6 14,5.55228 14,5 C14,4.44772 13.5523,4 13,4 Z" fill="#00E8DA"/>
            </svg>
        </div>

        <!-- Battery and WiFi Icons -->
        <div class="hud-icon-group">
            <!-- Battery Indicator (Vertical) -->
            <div class="hud-icon-container">
                <svg class="battery-icon-vertical" id="battery-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <!-- Outer outline (teal, constant) -->
                    <path d="M17,20V6a1,1,0,0,0-1-1H8A1,1,0,0,0,7,6V20a1,1,0,0,0,1,1h8A1,1,0,0,0,17,20ZM14,5H10V3h4Z" fill="none" stroke="#00E8DA" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                    <!-- Inner fill (color-coded, dynamic y/height) -->
                    <rect id="battery-fill" x="11" y="9" width="2" height="8" fill="#10b981" stroke="#10b981" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
                </svg>
                <span class="hud-icon-value" id="battery-level">--%</span>
            </div>

            <!-- WiFi/Ping Indicator (Signal Strength Icon) -->
            <div class="hud-icon-container">
                <svg class="wifi-icon" id="wifi-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <!-- Left waves (color-coded by ping) -->
                    <g id="wifi-waves-left" class="wifi-waves">
                        <path d="M2,18.992c0,5.832,2.28,11.292,6.362,15.374c0.902,0.899,2.28,0.899,3.181,0c0.902-0.9,0.902-2.279,0-3.183c-3.233-3.231-5.036-7.58-5.088-12.19C6.508,14.381,8.31,10.034,11.543,6.8c0.902-0.901,0.902-2.279,0-3.181c-0.901-0.9-2.28-0.901-3.181,0C4.28,7.701,2,13.161,2,18.992z" fill="#10b981"/>
                        <path d="M14.723,28.004c0.902,0.902,2.28,0.902,3.182,0c0.9-0.9,0.9-2.278,0-3.181c-1.538-1.537-2.438-3.605-2.438-5.831c-0.001-2.227,0.847-4.241,2.438-5.832c0.9-0.901,0.9-2.279,0-3.181c-0.902-0.9-2.28-0.901-3.182,0c-2.385,2.385-3.71,5.62-3.71,9.012C11.013,22.385,12.338,25.619,14.723,28.004z" fill="#10b981"/>
                    </g>
                    <!-- Right waves (color-coded by ping) -->
                    <g id="wifi-waves-right" class="wifi-waves">
                        <path d="M43.499,3.618c-0.901-0.901-2.28-0.9-3.181,0c-0.901,0.902-0.901,2.28,0,3.181c3.232,3.234,5.035,7.581,5.089,12.193c-0.054,4.611-1.855,8.959-5.089,12.191c-0.901,0.901-0.901,2.28,0,3.182c0.899,0.9,2.277,0.9,3.181,0c4.081-4.082,6.36-9.542,6.36-15.374C49.859,13.161,47.582,7.701,43.499,3.618z" fill="#10b981"/>
                        <path d="M40.85,18.992c-0.002-3.392-1.326-6.627-3.713-9.012c-0.9-0.901-2.279-0.9-3.181,0c-0.901,0.902-0.899,2.28,0,3.181c1.591,1.59,2.438,3.604,2.438,5.832c0,2.226-0.9,4.294-2.438,5.831c-0.901,0.902-0.899,2.279,0,3.181c0.901,0.902,2.28,0.902,3.181,0C39.523,25.619,40.848,22.385,40.85,18.992z" fill="#10b981"/>
                    </g>
                    <!-- Center tower (teal, constant) -->
                    <path id="wifi-center" d="M23.662,24.349c-2.12-0.881-3.61-2.972-3.61-5.411c0-3.235,2.623-5.857,5.857-5.857c3.234,0,5.856,2.622,5.856,5.857c0,2.426-1.475,4.507-3.576,5.396l-0.03,2.759v20.844c0,0.601-0.524,1.125-1.125,1.052h-2.249c-0.599,0-1.125-0.525-1.125-1.125V27.02L23.662,24.349z" fill="#00E8DA"/>
                </svg>
                <span class="hud-icon-value" id="ping-value">---</span>
            </div>

            <!-- Temperature Indicator -->
            <div class="hud-icon-container">
                <svg class="temp-icon" id="temp-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <!-- Outer outline (teal, constant) -->
                    <path id="temp-outline" d="M14.863,13.4V4.939a2.929,2.929,0,0,0-.84-2.03,2.859,2.859,0,0,0-2.23-.82,2.948,2.948,0,0,0-2.66,3l.01,8.28a4.755,4.755,0,0,0,1.9,8.46,5.093,5.093,0,0,0,.95.09,4.759,4.759,0,0,0,4.76-4.75A4.684,4.684,0,0,0,14.863,13.4Zm-.48,6.66a3.783,3.783,0,0,1-3.15.78,3.7,3.7,0,0,1-2.92-2.98,3.745,3.745,0,0,1,1.43-3.69.962.962,0,0,0,.39-.77V5.089a1.968,1.968,0,0,1,1.73-2,.66.66,0,0,1,.14-.01,1.878,1.878,0,0,1,1.86,1.86V13.4a.962.962,0,0,0,.39.77,3.742,3.742,0,0,1,.13,5.89Z" fill="#00E8DA" stroke="#00E8DA" stroke-width="0.5"/>
                    <!-- Inner fill (color-coded by temperature) -->
                    <path id="temp-fill" d="M13.893,17.169a1.89,1.89,0,0,1-3.78,0,1.858,1.858,0,0,1,1.39-1.81V5.4a.5.5,0,0,1,1,0v9.96A1.869,1.869,0,0,1,13.893,17.169Z" fill="#10b981" stroke="#10b981" stroke-width="0.5"/>
                </svg>
                <span class="hud-icon-value" id="temp-value">--°C</span>
            </div>
        </div>
    </div>

    <!-- Bottom-Right HUD Group -->
    <div class="hud-bottom-right">
        <!-- Light Level Slider (Right Side) -->
        <div class="hud-light-slider">
            <!-- Flashlight ON icon (teal, shown when brightness > 0) -->
            <svg id="light-icon-on" class="light-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 372.278 372.278" style="display: none;">
                <!-- License: CC0. Made by SVG Repo: https://www.svgrepo.com/svg/107218/flashlight -->
                <path d="M209.454,56.757c-5.856-5.858-15.355-5.857-21.213,0l-42.428,42.426c-0.046,0.045-0.085,0.097-0.13,0.143c-0.256,0.263-0.502,0.534-0.738,0.815c-0.061,0.073-0.124,0.143-0.184,0.217c-0.271,0.335-0.527,0.681-0.77,1.039c-0.052,0.077-0.1,0.156-0.149,0.233c-0.196,0.303-0.382,0.614-0.558,0.931c-0.049,0.089-0.099,0.176-0.146,0.266c-0.2,0.383-0.387,0.774-0.555,1.175c-0.027,0.064-0.049,0.13-0.075,0.194c-0.138,0.345-0.263,0.695-0.376,1.052c-0.035,0.109-0.07,0.219-0.102,0.329c-0.123,0.417-0.234,0.84-0.32,1.271l-13.25,66.258l-36.295,36.295c-5.574-2.66-12.445-1.698-17.062,2.919L46.82,240.606c-4.616,4.616-5.579,11.487-2.919,17.062L4.394,297.174c-5.858,5.858-5.858,15.355,0,21.213l49.496,49.496c2.929,2.929,6.768,4.394,10.606,4.394c3.839,0,7.678-1.464,10.606-4.394L199.17,243.816l66.258-13.25c0.432-0.087,0.854-0.197,1.271-0.32c0.11-0.032,0.22-0.067,0.328-0.102c0.357-0.113,0.709-0.238,1.053-0.377c0.065-0.026,0.13-0.048,0.193-0.075c0.401-0.168,0.793-0.355,1.176-0.556c0.089-0.046,0.176-0.097,0.265-0.145c0.318-0.175,0.63-0.361,0.933-0.559c0.078-0.05,0.156-0.097,0.232-0.148c0.358-0.242,0.705-0.499,1.04-0.77c0.072-0.059,0.142-0.122,0.214-0.181c0.283-0.238,0.557-0.486,0.821-0.745c0.045-0.043,0.095-0.081,0.139-0.126l42.428-42.428c2.814-2.813,4.394-6.628,4.394-10.606c0-3.979-1.58-7.793-4.394-10.607L209.454,56.757z M64.496,336.063L36.213,307.78l106.066-106.066l28.283,28.283L64.496,336.063z M196.706,213.714l-38.144-38.144l7.07-35.355l66.428,66.428L196.706,213.714z M262.487,194.643l-84.853-84.853l21.214-21.213l84.853,84.852L262.487,194.643z" style="fill: #00E8DA; stroke: #00E8DA; stroke-linecap: round; stroke-linejoin: round; stroke-width: 0;"/>
                <path d="M357.278,104.816h-21.125c-8.284,0-15,6.716-15,15c0,8.284,6.716,15,15,15h21.125c8.284,0,15-6.716,15-15C372.278,111.531,365.562,104.816,357.278,104.816z" style="fill: #00E8DA; stroke: #00E8DA; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                <path d="M252.46,51.125L252.46,51.125c8.284,0,15-6.715,15.001-14.999l0.002-21.124c0.001-8.284-6.714-15-14.999-15.002h-0.001c-8.283,0-14.999,6.715-15,14.999l-0.002,21.124C237.46,44.408,244.175,51.124,252.46,51.125z" style="fill: #00E8DA; stroke: #00E8DA; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                <path d="M311.641,75.637c3.838,0,7.678-1.464,10.606-4.393l14.938-14.936c5.857-5.858,5.858-15.355,0.001-21.213c-5.858-5.857-15.355-5.859-21.214,0L301.034,50.03c-5.857,5.858-5.858,15.355-0.001,21.213C303.963,74.173,307.802,75.637,311.641,75.637z" style="fill: #00E8DA; stroke: #00E8DA; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
            </svg>
            <!-- Flashlight OFF icon (red, shown when brightness = 0) -->
            <svg id="light-icon-off" class="light-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 372.278 372.278">
                <!-- License: CC0. Made by SVG Repo: https://www.svgrepo.com/svg/107218/flashlight -->
                <path d="M209.454,56.757c-5.856-5.858-15.355-5.857-21.213,0l-42.428,42.426c-0.046,0.045-0.085,0.097-0.13,0.143c-0.256,0.263-0.502,0.534-0.738,0.815c-0.061,0.073-0.124,0.143-0.184,0.217c-0.271,0.335-0.527,0.681-0.77,1.039c-0.052,0.077-0.1,0.156-0.149,0.233c-0.196,0.303-0.382,0.614-0.558,0.931c-0.049,0.089-0.099,0.176-0.146,0.266c-0.2,0.383-0.387,0.774-0.555,1.175c-0.027,0.064-0.049,0.13-0.075,0.194c-0.138,0.345-0.263,0.695-0.376,1.052c-0.035,0.109-0.07,0.219-0.102,0.329c-0.123,0.417-0.234,0.84-0.32,1.271l-13.25,66.258l-36.295,36.295c-5.574-2.66-12.445-1.698-17.062,2.919L46.82,240.606c-4.616,4.616-5.579,11.487-2.919,17.062L4.394,297.174c-5.858,5.858-5.858,15.355,0,21.213l49.496,49.496c2.929,2.929,6.768,4.394,10.606,4.394c3.839,0,7.678-1.464,10.606-4.394L199.17,243.816l66.258-13.25c0.432-0.087,0.854-0.197,1.271-0.32c0.11-0.032,0.22-0.067,0.328-0.102c0.357-0.113,0.709-0.238,1.053-0.377c0.065-0.026,0.13-0.048,0.193-0.075c0.401-0.168,0.793-0.355,1.176-0.556c0.089-0.046,0.176-0.097,0.265-0.145c0.318-0.175,0.63-0.361,0.933-0.559c0.078-0.05,0.156-0.097,0.232-0.148c0.358-0.242,0.705-0.499,1.04-0.77c0.072-0.059,0.142-0.122,0.214-0.181c0.283-0.238,0.557-0.486,0.821-0.745c0.045-0.043,0.095-0.081,0.139-0.126l42.428-42.428c2.814-2.813,4.394-6.628,4.394-10.606c0-3.979-1.58-7.793-4.394-10.607L209.454,56.757z M64.496,336.063L36.213,307.78l106.066-106.066l28.283,28.283L64.496,336.063z M196.706,213.714l-38.144-38.144l7.07-35.355l66.428,66.428L196.706,213.714z M262.487,194.643l-84.853-84.853l21.214-21.213l84.853,84.852L262.487,194.643z" style="fill: #ef4444; stroke-linecap: round;"/>
            </svg>
            <span class="light-level-value" id="light-level-value">0</span>
            <input type="range"
                   id="light-level-slider"
                   min="0"
                   max="10"
                   step="1"
                   value="0"
                   class="slider-horizontal">
        </div>

        <!-- Audio and Settings Controls -->
        <div class="hud-icon-group">
            <!-- Microphone Icon (Transmission Toggle - Click or Press 'C' or Hold Right Mouse Button) -->
            <button id="mic-icon" class="hud-audio-icon mic-inactive" onclick="toggleMicrophoneTransmission()" title="Microphone: Click or press 'C' to toggle ON/OFF, hold right mouse button for push-to-talk">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <!-- Microphone outline (teal, constant) -->
                    <path id="mic-outline" d="M12,17h0a4,4,0,0,1-4-4V7a4,4,0,0,1,4-4h0a4,4,0,0,1,4,4v6A4,4,0,0,1,12,17Zm0,0v4m3,0H9" style="fill: none; stroke: #00E8DA; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                    <!-- Strikethrough line (red, shown when inactive) -->
                    <line id="mic-strikethrough" x1="4" y1="4" x2="20" y2="20" style="fill: none; stroke: #ef4444; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                </svg>
            </button>

            <!-- Speaker Icon (Reception Status - Click to Toggle) -->
            <button id="speaker-icon" class="hud-audio-icon speaker-inactive" onclick="toggleAudioReception()" title="Audio Reception: Click to toggle hearing robot audio">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 490 490">
                    <!-- Speaker body (teal, constant) -->
                    <path id="speaker-body" d="M273.6,4.493l-173.6,127H20.8c-11.4,0-20.8,9.4-20.8,20.8v185.2c0,11.4,9.4,20.8,20.8,20.8h80.6l172.3,126.9c8.5,8.5,33.3,4.2,33.3-15.6v-448.4C306.9,0.793,282.8-3.607,273.6,4.493z M86.3,317.693H40.6v-145.7h45.8v145.7H86.3z M265.3,428.993L129,328.893v-168l136.3-100.2V428.993z" style="fill: #00E8DA; stroke: #00E8DA; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                    <!-- Sound waves (green, shown when active) - hidden by default (inactive state) -->
                    <path id="speaker-wave-outer" d="M436.9,108.593c-8.3-8.3-20.8-8.3-29.1-1c-8.3,8.3-8.3,20.8-1,29.1c56.2,60.3,56.2,157.1,0,216.4c-7.3,8.3-7.3,21.8,1,29.1c7,7,20.5,7.5,29.1-2.1C507.7,305.193,507.7,183.493,436.9,108.593z" style="display: none; fill: #10b981; stroke: #10b981; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                    <path id="speaker-wave-inner" d="M375.6,173.093c-8.3-8.3-20.8-8.3-29.1-1c-8.3,8.3-8.3,20.8,0,29.1c22.9,23.9,22.9,63.5,0,87.4c-7.3,8.3-7.3,21.8,1,29.1c5.4,5.4,18.4,8.6,28.1-1C414.1,278.093,413,212.593,375.6,173.093z" style="display: none; fill: #10b981; stroke: #10b981; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"/>
                    <!-- Red X (shown when inactive) -->
                    <path id="speaker-x" transform="translate(130, 71.36)" d="M306.996,173.639l36.619-36.621c4.883-4.882,4.883-12.796,0-17.678c-4.881-4.881-12.795-4.881-17.678,0l-36.621,36.621l-36.621-36.621c-4.881-4.881-12.795-4.881-17.678,0c-4.881,4.882-4.881,12.796,0,17.678l36.623,36.621L235.02,210.26c-4.881,4.882-4.881,12.796,0,17.678c2.441,2.44,5.639,3.661,8.838,3.661s6.398-1.221,8.84-3.661l36.621-36.621l36.621,36.621c2.439,2.44,5.641,3.661,8.838,3.661c3.199,0,6.398-1.221,8.84-3.661c4.881-4.882,4.881-12.796,0-17.678L306.996,173.639z" style="fill: #ef4444; stroke: #ef4444; stroke-linecap: round; stroke-linejoin: round; stroke-width: 6;"/>
                </svg>
            </button>

            <!-- Settings Button -->
            <button id="quick-settings-btn" class="hud-btn">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>

            <!-- Disconnect Button -->
            <button id="exit-btn" class="hud-btn hud-btn-danger">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Speed Indicator Overlay (Mouse Wheel Speed Adjustment) - Temporary popup -->
    <div id="speedIndicator" class="speed-indicator">
        <div class="speed-label">Movement Speed</div>
        <div class="speed-value" id="speedValue">100%</div>
    </div>

    <!-- Height Indicator disabled - BodyHeight API (1013) returns code 3203 in AI mode -->
    <!--
    <div id="heightIndicator" class="height-indicator" style="display: none; opacity: 0;">
        <div class="height-label">Body Height</div>
        <div class="height-bars">
            <div class="height-bar" data-level="0"></div>
            <div class="height-bar" data-level="1"></div>
            <div class="height-bar" data-level="2"></div>
        </div>
        <div class="height-value" id="heightValue">MIDDLE</div>
    </div>
    -->



    <!-- RAGE MODE Warning Modal (hidden by default) -->
    <div id="rage-mode-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div style="position: relative; background: #1a1a1a; border-radius: 8px; padding: 24px; max-width: 500px; border: 2px solid #ef4444; z-index: 10;">
            <h3 style="font-size: 1.5rem; font-weight: bold; color: #ef4444; margin-bottom: 16px;">⚠️ RAGE MODE WARNING</h3>
            <p style="color: white; margin-bottom: 16px;">
                RAGE MODE disables ALL safety smoothing (exponential curves, acceleration limiting, deadzone).
                Robot will respond to raw input instantly, which may cause:
            </p>
            <ul style="color: white; margin-bottom: 16px; list-style-type: disc; padding-left: 24px;">
                <li>Jerky, erratic movements</li>
                <li>Sudden acceleration/deceleration</li>
                <li>Potential motor strain</li>
                <li>Loss of precision control</li>
            </ul>
            <p style="color: white; margin-bottom: 24px; font-weight: bold;">Use at your own risk. Recommended for emergency maneuvers only.</p>
            <div style="display: flex; gap: 16px;">
                <button id="rage-mode-confirm" style="flex: 1; background: #ef4444; color: white; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold;">I Understand - Enable RAGE MODE</button>
                <button id="rage-mode-cancel" style="flex: 1; background: #4b5563; color: white; padding: 12px; border-radius: 8px; border: none; cursor: pointer;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Slide-In Panel -->
    <div id="settings-panel" class="settings-panel">
        <!-- Backdrop overlay -->
        <div id="settings-backdrop" class="settings-backdrop"></div>

        <!-- Panel content -->
        <div class="settings-panel-content">
            <!-- Header -->
            <div class="settings-panel-header">
                <h2 class="text-2xl font-bold text-unitree-primary">⚙️ Control Settings</h2>
                <button id="settings-close-btn" class="settings-close-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Settings body -->
            <div class="settings-panel-body">
                <!-- Preset Buttons -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-3 text-gray-300">Control Presets</h3>
                    <div class="flex flex-wrap gap-3">
                        <button id="preset-beginner" class="preset-btn" data-preset="beginner">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Beginner
                        </button>
                        <button id="preset-normal" class="preset-btn preset-btn-active" data-preset="normal">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Normal
                        </button>
                        <button id="preset-advanced" class="preset-btn" data-preset="advanced">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Advanced
                        </button>
                        <button id="preset-sport" class="preset-btn" data-preset="sport">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Sport
                        </button>
                        <button id="preset-custom" class="preset-btn" data-preset="custom">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                            </svg>
                            Custom
                        </button>
                    </div>
                    <p class="text-sm text-gray-400 mt-2">Select a preset or adjust individual sliders below.</p>
                </div>

                <!-- Response Curve Tuning -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-unitree-primary">⚙️ Response Curve Tuning</h3>
                    <p class="text-sm text-gray-400 mb-6">Adjust the exponential response curves for fine-tuned control feel. Higher alpha = smoother acceleration, lower alpha = more responsive.</p>

                    <!-- Curve Controls Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <!-- Linear Axis -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-unitree-primary">Linear (Forward/Back)</h4>
                            <div class="bg-unitree-dark-lighter rounded-lg p-4">
                                <canvas id="linear-curve-chart" height="200"></canvas>
                            </div>
                            <div class="form-group">
                                <label for="kb-max-linear-velocity" class="form-label flex justify-between">
                                    <span>Max Velocity</span>
                                    <span id="kb-max-linear-value" class="text-unitree-primary font-mono">1.5 m/s</span>
                                </label>
                                <input type="range" id="kb-max-linear-velocity" class="slider" min="0.3" max="5.0" step="0.1" value="1.5"
                                       title="Maximum forward/backward speed. Hardware limit is 5.0 m/s.">
                                <p class="form-help">Hardware limit: 5.0 m/s</p>
                            </div>
                            <div class="form-group">
                                <label for="linear-alpha" class="form-label flex justify-between">
                                    <span>Alpha (α)</span>
                                    <span id="linear-alpha-value" class="text-unitree-primary font-mono">1.5</span>
                                </label>
                                <input type="range" id="linear-alpha" class="slider" min="0.1" max="4.0" step="0.1" value="1.5"
                                       title="Curve steepness. Lower = responsive, Higher = smoother.">
                                <p class="form-help">Curve steepness (0.1-4.0)</p>
                            </div>
                            <div class="form-group">
                                <label for="linear-ramp-time" class="form-label flex justify-between">
                                    <span>Acceleration Time</span>
                                    <span id="linear-ramp-time-value" class="text-unitree-primary font-mono">0.20s</span>
                                </label>
                                <input type="range" id="linear-ramp-time" class="slider" min="0.01" max="0.5" step="0.01" value="0.20"
                                       title="Time to reach max linear speed from standstill.">
                                <p class="form-help">Ramp-up time (0.01-0.50s)</p>
                            </div>
                        </div>

                        <!-- Strafe Axis -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-unitree-primary">Strafe (Left/Right)</h4>
                            <div class="bg-unitree-dark-lighter rounded-lg p-4">
                                <canvas id="strafe-curve-chart" height="200"></canvas>
                            </div>
                            <div class="form-group">
                                <label for="kb-max-strafe-velocity" class="form-label flex justify-between">
                                    <span>Max Velocity</span>
                                    <span id="kb-max-strafe-value" class="text-unitree-primary font-mono">1.0 m/s</span>
                                </label>
                                <input type="range" id="kb-max-strafe-velocity" class="slider" min="0.1" max="1.0" step="0.05" value="1.0"
                                       title="Maximum left/right speed. Hardware limit is 1.0 m/s.">
                                <p class="form-help">Hardware limit: 1.0 m/s</p>
                            </div>
                            <div class="form-group">
                                <label for="strafe-alpha" class="form-label flex justify-between">
                                    <span>Alpha (α)</span>
                                    <span id="strafe-alpha-value" class="text-unitree-primary font-mono">1.2</span>
                                </label>
                                <input type="range" id="strafe-alpha" class="slider" min="0.1" max="4.0" step="0.1" value="1.2"
                                       title="Curve steepness. Lower = responsive, Higher = smoother.">
                                <p class="form-help">Curve steepness (0.1-4.0)</p>
                            </div>
                            <div class="form-group">
                                <label for="strafe-ramp-time" class="form-label flex justify-between">
                                    <span>Acceleration Time</span>
                                    <span id="strafe-ramp-time-value" class="text-unitree-primary font-mono">0.20s</span>
                                </label>
                                <input type="range" id="strafe-ramp-time" class="slider" min="0.01" max="0.5" step="0.01" value="0.20"
                                       title="Time to reach max strafe speed from standstill.">
                                <p class="form-help">Ramp-up time (0.01-0.50s)</p>
                            </div>
                        </div>

                        <!-- Rotation Axis -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-unitree-primary">Rotation (Yaw)</h4>
                            <div class="bg-unitree-dark-lighter rounded-lg p-4">
                                <canvas id="rotation-curve-chart" height="200"></canvas>
                            </div>
                            <div class="form-group">
                                <label for="mouse-yaw-sensitivity" class="form-label flex justify-between">
                                    <span>Mouse Yaw Sensitivity</span>
                                    <span id="mouse-yaw-value" class="text-unitree-primary font-mono">5.0</span>
                                </label>
                                <input type="range" id="mouse-yaw-sensitivity" class="slider" min="0.1" max="50.0" step="0.1" value="5.0"
                                       title="How fast the robot rotates from horizontal mouse movement.">
                                <p class="form-help">Horizontal mouse sensitivity (0.1-50.0)</p>
                            </div>

                            <div class="form-group">
                                <label for="kb-max-rotation-velocity" class="form-label flex justify-between">
                                    <span>Max Velocity</span>
                                    <span id="kb-max-rotation-value" class="text-unitree-primary font-mono">3.0 rad/s</span>
                                </label>
                                <input type="range" id="kb-max-rotation-velocity" class="slider" min="0.5" max="3.0" step="0.1" value="3.0"
                                       title="Maximum rotation speed. Hardware limit is 3.0 rad/s.">
                                <p class="form-help">Hardware limit: 3.0 rad/s</p>
                            </div>
                            <div class="form-group">
                                <label for="rotation-alpha" class="form-label flex justify-between">
                                    <span>Alpha (α)</span>
                                    <span id="rotation-alpha-value" class="text-unitree-primary font-mono">2.5</span>
                                </label>
                                <input type="range" id="rotation-alpha" class="slider" min="0.1" max="4.0" step="0.1" value="2.5"
                                       title="Curve steepness. Lower = responsive, Higher = smoother.">
                                <p class="form-help">Curve steepness (0.1-4.0)</p>
                            </div>

                            <div class="form-group">
                                <label for="rotation-ramp-time" class="form-label flex justify-between">
                                    <span>Acceleration Time</span>
                                    <span id="rotation-ramp-time-value" class="text-unitree-primary font-mono">0.20s</span>
                                </label>
                                <input type="range" id="rotation-ramp-time" class="slider" min="0.01" max="0.5" step="0.01" value="0.20"
                                       title="Time to reach max rotation speed from standstill.">
                                <p class="form-help">Ramp-up time (0.01-0.50s)</p>
                            </div>
                        </div>

                        <!-- Pitch Axis -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-unitree-primary">Pitch (Body Tilt)</h4>
                            <div class="bg-unitree-dark-lighter rounded-lg p-4">
                                <canvas id="pitch-curve-chart" height="200"></canvas>
                            </div>
                            <div class="form-group">
                                <label for="mouse-pitch-sensitivity" class="form-label flex justify-between">
                                    <span>Mouse Pitch Sensitivity</span>
                                    <span id="mouse-pitch-value" class="text-unitree-primary font-mono">2.5</span>
                                </label>
                                <input type="range" id="mouse-pitch-sensitivity" class="slider" min="0.1" max="25.0" step="0.1" value="2.5"
                                       title="How fast the body tilts from vertical mouse movement.">
                                <p class="form-help">Vertical mouse sensitivity (0.1-25.0)</p>
                            </div>
                            <div class="form-group">
                                <label for="pitch-max-velocity" class="form-label flex justify-between">
                                    <span>Max Pitch Angle</span>
                                    <span id="pitch-max-value" class="text-unitree-primary font-mono">0.35 rad</span>
                                </label>
                                <input type="range" id="pitch-max-velocity" class="slider" min="0.10" max="0.35" step="0.01" value="0.35"
                                       title="Maximum body tilt angle. Hardware limit is 0.35 rad (~20°).">
                                <p class="form-help">Hardware limit: 0.35 rad (~20°)</p>
                            </div>
                            <div class="form-group">
                                <label for="pitch-alpha" class="form-label flex justify-between">
                                    <span>Alpha (α)</span>
                                    <span id="pitch-alpha-value" class="text-unitree-primary font-mono">2.0</span>
                                </label>
                                <input type="range" id="pitch-alpha" class="slider" min="0.1" max="4.0" step="0.1" value="2.0"
                                       title="Curve steepness. Lower = responsive, Higher = smoother.">
                                <p class="form-help">Curve steepness (0.1-4.0)</p>
                            </div>

                            <div class="form-group">
                                <label for="pitch-ramp-time" class="form-label flex justify-between">
                                    <span>Acceleration Time</span>
                                    <span id="pitch-ramp-time-value" class="text-unitree-primary font-mono">0.20s</span>
                                </label>
                                <input type="range" id="pitch-ramp-time" class="slider" min="0.01" max="0.5" step="0.01" value="0.20"
                                       title="Time to reach max pitch angle from neutral position.">
                                <p class="form-help">Ramp-up time (0.01-0.50s)</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Socket.IO Client Library -->
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<!-- Control modules -->
<script src="{{ url_for('static', filename='js/curve-utils.js') }}?v=1.1.0"></script>
<script src="{{ url_for('static', filename='js/curve-visualizer.js') }}?v=1.1.0"></script>
<script src="{{ url_for('static', filename='js/settings-manager.js') }}?v=1.2.0"></script>
<script src="{{ url_for('static', filename='js/websocket-client.js') }}?v=1.0.2"></script>
<script src="{{ url_for('static', filename='js/keyboard-mouse-control.js') }}?v=1.5.0"></script>
<script src="{{ url_for('static', filename='js/gamepad-control.js') }}?v=1.0.1"></script>

<!-- Main control script -->
<script src="{{ url_for('static', filename='js/control.js') }}?v=1.3.0"></script>
{% endblock %}

